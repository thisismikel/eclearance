<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="referrer" content="origin">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="ol.css">
<style>
	#map {height: 100%; width:100%;}
</style>

</head>
<body>
<div class="container">
	<div id="header1"></div>
	<div id="content">
		
	   <div class="paper paper-polar" >
	   <div class="row">
			<h4 class="text-center">Legal</h4></div>	
	   </div>
	   <div id="list">
	     
	   
		<div class="row">
			<div class="paper paper-polar" >
			<div class="row">
			<div class="col-xs-12">
					<h3>List of Applications Legal Recommendations</h3>
										<table class="table table-hover" id="ds" style="width:100%">
					<thead><tr><th></th><th>Tracking No</th><th>Applicant</th><th>Date</th><th></th><th></th></tr></thead>
					<tfoot><tr><th></th><th>Tracking No</th><th>Applicant</th><th>Date</th><th></th><th></th></tr></tfoot>
					<tbody></tbody>
					</table>
					
				</div>	
			</div>
			</div>
		</div>
	   </div>	   
	   <div id="details" style="display:none">
			<form name="entryform" id="entryform">
					<fieldset name="myfields" id="myfields" disabled>
								<input type="hidden" name="iddcrform" class="iddcrform">
								<input type="hidden" name="trans" id="trans" class="trans">
								<input type="hidden" name="tk" id="tk" class="tk">
								<input type="hidden" name="officecode" id="officecode">
								<input type="hidden" name="municipal" id="municipal" class="municipal">
								<input type="hidden" name="provincial" id="provincial" class="provincial">
								<input type="hidden" name="regional" id="regional" class="regional">
								
							<div class="form-group col-sm-12">
								<label>Applicant:</label>
								<input type="text" class="form-control" name="applicant" placeholder="Fullname">
							</div>
							<div class="form-group col-sm-12">
								<label>Address:</label>
								<input type="text" class="form-control" name="address">
							</div>
							<div class="form-group col-sm-12">
								<label>Email:</label>
								<input type="email" class="form-control" name="email">
							</div>
							<div class="form-group col-sm-12">
								<label>Mobile No:</label>
								<input type="text" class="form-control" name="cellno">
							</div>
							<div class="form-group col-sm-12">
								<label>Telephone No:</label>
								<input type="text" class="form-control" name="telno">
							</div>
							<div class="form-group col-sm-12">
								<label>Property Location:</label>
								<input type="text" class="form-control" name="propertylocation" placeholder="Address">
							</div>
							
							<div class="form-group col-sm-12">
								<label>Latitude:</label>
								<input type="number" class="form-control" name="latitude" min="0" step="any">
							</div>
							<div class="form-group col-sm-12">
								<label>Longtitude:</label>
								<input type="number" class="form-control" name="longtitude" min="0" step="any">
							</div>
							<div class="col-xs-12"><button type="button" class="btn btn-info" onclick="showmap(this.form)">View Map</button></div>
							
							<div class="col-sm-12">
								<label>Transaction Type:</label>
								<select name="transaction" class="form-control">
									<option value="TRANSFER">TRANSFER</option>
								</select>
								
							</div>
											
							<div class="form-group col-sm-12">
								<label>Date Filed:</label>
								<input type="date" class="form-control" name="datefiled" >
							</div>
							<div class="col-sm-12">
								<label><input type="checkbox" name="urgent" value="Y">Urgent</label>
							</div>
							<div class="form-group col-sm-12">
								<label>Reference No.:</label>
								<input type="text" class="form-control" name="referenceno">
							</div>
							
							<div class="col-sm-12">
								<label>Submitted documents:</label><br>
								<div class="col-sm-6">
									<label><input type="checkbox" name="amortization" value="Y">Certificate of Full Payment of Amortization</label><br>
									<label><input type="checkbox" name="nia" value="Y">Certification regarding Full Payment of Irrigation Fees</label>
									<label><input type="checkbox" name="loancert" value="Y">Certification regarding Loans</label>
									<label><input type="checkbox" name="taxclearance" value="Y">Tax clearance</label>
									<label><input type="checkbox" name="affidavittransferor" value="Y">Affidavit of the transferor</label>
								</div>
								<div class="col-sm-6">
									<label><input type="checkbox" name="affidavitaggregate" value="Y">Affidavit of Aggregate Area</label><br>
									<label><input type="checkbox" name="taxreturn" value="Y">Certified copy of Income Tax Return</label>
									<label><input type="checkbox" name="rescert" value="Y">Residence Certificate</label>
									<label><input type="checkbox" name="assessor" value="Y">Certification by the Provincial Assessor's Office</label>
								</div>
							</div>
							<div class="form-group col-sm-12">
								<label>Municipal Office:</label>
								<input type="text" class="form-control" name="municipalname" readonly>
							</div>
							<div class="form-group col-sm-12">
								<label>Provincial Office:</label>
								<input type="text" class="form-control" name="provincialname" readonly>
							</div>
							<div class="form-group col-sm-12">
								<label>Regional Office:</label>
								<input type="text" class="form-control" name="regionalname" readonly>
							</div>
							<div class="form-group col-sm-12">
								<label for="comment">Remarks:</label>
								<textarea class="form-control" rows="5" name="remarks"></textarea>
							</div>
							<div class="form-group col-sm-12">
								<label>Prepared by</label>
								<input type="text" class="form-control" name="preparedby" placeholder="Enter fullname" >
							</div>
							
							
							
					</fieldset>
					<div class="col-xs-12"><button type="button" class="btn btn-info btn-sm" onclick="showmap(this.form)">View Map</button></div>
					
					<div class="col-xs-12">
					<br>
						<button name="butsave" type="button" onclick="savethis(this.form)" class="btn btn-primary" id="savebut">Save</a>
						<button name="butupdate" type="button" onclick="updatethis(this.form)" class="btn btn-success" id="updatebut">Update</a>
						<button name="butprint" type="button" onclick="printthis(this.form)" class="btn btn-primary" id="printbut">Print</a>	
						<button name="butcancel" type="button" onclick="cancelthis(this.form)" class="btn btn-default" id="cancelbut">Cancel</a>
						<button name="butclose" type="button" onclick="closethis(this.form)" class="btn btn-danger" id="closebut">Close</a>	
					</div>	
			</form>
			<div class="col-xs-6" id="divattachment">
						<div class="col-xs-12">
							<h5>Attachment/s:</h5>
							<button type="button" class="btn btn-default" onclick="addimages();return false;" id="attachmentbutton">Add Image (max image size is 3mb)</button>
							<br><br>
						</div>
						<div class="col-xs-12">
							<div id="divimages"></div>
						</div>
			</div>
			<div class="col-xs-6" id="transferorder">
						<div class="col-xs-12">
						
							<h5>Order of Transfer:</h5>
							<div class="col-xs-12" id="divdocs"></div>
							
						</div>
						
			</div>
		</div>
	  
		
		
	   
	</div>
</div>
<div id="header"></div>


<div id="mySave" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      
      <div class="modal-body">
		  <img class="img-responsive center-block" alt="saving" src="images/saving.gif">
		  <div class="col-xs-12" style="text-align:center"><span>Saving Please Wait</span></div>
	  </div>
      
    </div>

  </div>
</div>

<div id="myRoute" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      
      <div class="modal-body">
		  <img class="img-responsive center-block" alt="routing" src="images/saving.gif">
		  <div class="col-xs-12" style="text-align:center"><span>Routing Please Wait</span></div>
	  </div>
      
    </div>

  </div>
</div>

<div id="myMap" class="modal" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
		<div class="row"><div id="map" class="map"></div><div id="popup"></div></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
</div>

<section><div id="attachmentdiv"></div></section>
</body>
<script src="jquery.min.js"></script>
<script src="bootstrap.min.js"></script>
<script src="jquery.dataTables.min.js"></script>
<script src="Buttons/js/buttons.print.min.js"></script>
<script src="jquery.toaster.js"></script>
<script src="bootbox.min.js"></script>
<script src="ol.js"></script>
<script src="main1.js"></script>

<script>
function signpdf(idorderdoc,filename,iddcrform){
let keyword = fullname;
$.get("searchpdfController.php",{"tk":tk,"keyword":keyword,"filename":filename,"iddcrform":iddcrform,"idorderdoc":idorderdoc,"signer":2},function(data){
											let page = data;
											
											if(page['pagenumber']>0 ){
												
													let x = page['cX'];
													let y = page['cY'];
													let filename = page['filename'];
													let signature = signimage;
													let iddcrform = page['iddcrform'];
													let pagenumber = page['pagenumber'];
													let idorderdoc = page['idorderdoc'];
													if (!signature){
														$.toaster({ priority : 'danger', title : 'Sign Document', message : 'Failed to sign. User signature not registered'});
													} else {
														let tk = qs['tk'];
														$.get("signdocController.php",{"tk":tk,"x":x,"y":y,"filename":filename,"pagenumber":pagenumber,"sigimage":signature,"iddcrform":iddcrform,"idorderdoc":idorderdoc,"tk":tk,"signer":2,"fullname":fullname},function(data){
															$.toaster({ priority : 'success', title : 'Sign Document', message : 'Document signed'});
															getorders(data['iddcrform']);
															
														},'json');
													}
											
											
											}else {
												 $.toaster({ priority : 'danger', title : 'Sign Document', message : 'Failed to sign. Signatory name not found'});
											}},'json');


}
function showpdf(idorderdoc){
let params = 'menubar=no,width=0, height=0`,location=no, status=no, toolbar=no';
let tk=qs['tk'];
	window.open('showpdfController.php?idorderdoc='+idorderdoc+"&tk="+tk,'pdfwindow',params);
	}
function getorders(iddcrform){
let tk = qs['tk'];

$.get("legalController.php",{"trans":"getorders","tk":tk,"iddcrform":iddcrform},function(data){
											let nlength = data.length;
											let scontent = '';
											for(i=0; i < nlength; i++){
												let row = data[i];
												let idorderdoc = "'"+row['idorderdoc']+"'";
												let orderdocdet ="'"+row['idorderdoc']+"','"+row['filename']+"','"+row['iddcrform']+"'";
												scontent += '<span class="glyphicon glyphicon-file"></span><button type="button" onclick="showpdf('+idorderdoc+')" class="btn btn-link">'+row['filename']+'</button>';
												if (row['signed2']=='0'){
													scontent += '<button type="button" onclick="signpdf('+orderdocdet+')" class="btn btn-primary btn-xs">Sign</button>';
												}
												scontent += '<br>';
												
											}
											
											document.getElementById('divdocs').innerHTML = scontent;
										},'json');
}

var tupdate = false;
var seen = false;
function startload() {
	var caption = "DAR Region XI";
	var today = new Date();
	var asDate = new Date();
	var options = { year: 'numeric', month: 'long', day: 'numeric' };
	var stoday = today.toLocaleDateString("en-US", options);
	
	
	var tk=qs['tk'];
	var table = $('#ds').DataTable( {
		"ajax": "legalheadController.php?trans=getdetails&tk="+tk+"&officecode="+soffice,
		"dom": 'lfrtBip', 
		"buttons": [
            "copy", 
			{extend:"excelHtml5","title" : "List of Encoded Applications", "messageTop": caption, "messageBottom": "\n Prepared by: "+ fullname + " " +stoday, "footer":true}, 
			{extend: 'pdf', 
			title : 'List of Encoded Applications'
			, messageTop: caption, messageBottom: '\n Prepared by: '+ fullname + ' ' +stoday, footer:true},
			{extend: 'print',
			title : 'List of Encoded Applications',
			 messageTop: caption, messageBottom: '\n Prepared by: '+ fullname + ' ' +stoday, footer:true
			
			}
        ],
        "columns": [
            {"className":      'details-control',
												 "orderable":      false,
												 "data":           null,
												 "defaultContent": ''},
			{ "data": "iddcrform"},
			{ "data": "applicant"},
			{ "data": "datefiled"},
			{ "data": function (d) {return seen1(d);} },
			{ "data": function (d) {return actions(d);} }
			
        ],
        "order": [[3, 'desc']]
    } );
	
	
	
	$('#ds tbody').on('click', 'td.details-control', function () {
		
         var tr = $(this).closest('tr');
        var row = table.row( tr );
 
        if ( row.child.isShown() ) {
            
            
			if (seen){$('#ds').DataTable().ajax.reload(null,false);
				seen = false;
			} else {
				row.child.hide();
				tr.removeClass('shown');
			};
			
        }
		
        else {
            if ( table.row( '.shown' ).length ) {
                  $('.details-control', table.row( '.shown' ).node()).click();
				  //$('.maindiv').hide();
				  //$( '.shown' ).removeClass('shown');
			}
            row.child( format(row.data())).show();
            tr.addClass('shown');
			getchild(row.data());
			setseen(row.data());
        }
		
    } );
	
	
	
	 
	startattachment();
	initload();
}

function setseen(d){
	$.get("darpoController.php",{"trans":"seen","idtrackform":d['idtrackform'],"tk":qs['tk']}, function (d){
		
		if (d['seen']==0) {seen=true;}
	},'json');
}
function actions(row){
	var buttons ='';
	
	
	var approvalkey = "'"+row['idtrackform']+"','"+row['iddcrform']+"','"+row['regional']+"','"+row['details']+"','"+row['regionalname']+"'";
	var provincialkey =  "'"+row['idtrackform']+"','"+row['iddcrform']+"','"+row['regional']+"','"+row['details']+"','"+row['regionalname']+"'";
												
	
	buttons ='<button type="button" onclick="legal('+provincialkey+')" data-toggle="tooltip" title="Legal" class="btn btn-link"><span class="glyphicon glyphicon-repeat"></span></button> <button type="button" onclick="approval('+approvalkey+')" data-toggle="tooltip" title="forApproval" class="btn btn-link"><span class="glyphicon glyphicon-thumbs-up"></span></button> <button type="button" onclick="disapproval('+approvalkey+')" data-toggle="tooltip" title="forDisApproval" class="btn btn-link"><span class="glyphicon glyphicon-thumbs-down"></span></button>';
	return buttons;
	
	
}

function seen1(d){
var data='';
	if (d['seen']!=0){
		data = "<span class='glyphicon glyphicon-eye-open'></span>";
	} 
	return data;
}

function format(row){
var iddcrform = row['iddcrform'];
var track = "track"+row['iddcrform'];

var elem = document.getElementById(iddcrform);
if (elem){
  elem.parentNode.removeChild(iddcrform);
}
var elem2 = document.getElementById(track);
if (elem2){
  elem2.parentNode.removeChild(track);
}
  return '<div class="maindiv"><div class="col-xs-12" id="'+iddcrform+'"></div><div class="col-xs-12" id="'+track+'"></div></div>';
}

function getchild(data){
var iddcrform = '#'+data['iddcrform'];

var tform = document.getElementById('form'+data['iddcrform']);
if (tform){
	tform.parentNode.removeChild('form'+data['iddcrform']);
}
var nform = $('#entryform').clone(true).prop('id','form'+data['iddcrform']);
nform.appendTo( iddcrform );
var x = document.getElementById('form'+data['iddcrform']);

	
	x.elements.namedItem('tk').value=qs['tk'];
	x.elements.namedItem('trans').value='UPDATE';
	x.elements.namedItem('iddcrform').value=data['iddcrform'];
	x.elements.namedItem('municipal').value=data['municipal'];
	x.elements.namedItem('provincial').value=data['provincial'];
	x.elements.namedItem('regional').value=data['regional'];
	x.elements.namedItem('municipalname').value=data['municipalname'];
	x.elements.namedItem('provincialname').value=data['provincialname'];
	x.elements.namedItem('regionalname').value=data['regionalname'];
	x.elements.namedItem('address').value= data['address'];
	x.elements.namedItem('applicant').value= data['applicant'];
	x.elements.namedItem('email').value= data['email'];
	x.elements.namedItem('cellno').value= data['cellno'];
	x.elements.namedItem('telno').value= data['telno'];
	x.elements.namedItem('transaction').value= data['transaction'];
	x.elements.namedItem('propertylocation').value= data['propertylocation'];
	x.elements.namedItem('longtitude').value= data['longtitude'];
	x.elements.namedItem('latitude').value= data['latitude'];
	x.elements.namedItem('referenceno').value= data['referenceno'];
	x.elements.namedItem('transaction').value= data['transaction'];
	x.elements.namedItem('remarks').value= data['remarks'];
	x.elements.namedItem('preparedby').value= data['preparedby'];
	x.elements.namedItem('datefiled').value= data['datefiled'];
	if (data['urgent']=='Y'){
		x.elements.namedItem('urgent').checked = true;
	} else {
		x.elements.namedItem('urgent').checked = false;
	}
	if (data['amortization']=='Y'){
		x.elements.namedItem('amortization').checked = true;
	} else {
		x.elements.namedItem('amortization').checked = false;
	}
	if (data['nia']=='Y'){
		x.elements.namedItem('nia').checked = true;
	} else {
		x.elements.namedItem('nia').checked = false;
	}
	if (data['taxclearance']=='Y'){
		x.elements.namedItem('taxclearance').checked = true;
	} else {
		x.elements.namedItem('taxclearance').checked = false;
	}
	if (data['affidavittransferor']=='Y'){
		x.elements.namedItem('affidavittransferor').checked = true;
	} else {
		x.elements.namedItem('affidavittransferor').checked = false;
	}
	if (data['affidavitaggregate']=='Y'){
		x.elements.namedItem('affidavitaggregate').checked = true;
	} else {
		x.elements.namedItem('affidavitaggregate').checked = false;
	}
	if (data['loancert']=='Y'){
		x.elements.namedItem('loancert').checked = true;
	} else {
		x.elements.namedItem('loancert').checked = false;
	}
	if (data['taxreturn']=='Y'){
		x.elements.namedItem('taxreturn').checked = true;
	} else {
		x.elements.namedItem('taxreturn').checked = false;
	}
	if (data['rescert']=='Y'){
		x.elements.namedItem('rescert').checked = true;
	} else {
		x.elements.namedItem('rescert').checked = false;
	}
	if (data['assessor']=='Y'){
		x.elements.namedItem('assessor').checked = true;
	} else {
		x.elements.namedItem('assessor').checked = false;
	}
	
	x.elements.namedItem('myfields').disabled = true;
	
	x.elements.namedItem('butupdate').style.display='none';
	x.elements.namedItem('butsave').style.display='none';
	x.elements.namedItem('butcancel').style.display='none';
	x.elements.namedItem('butclose').style.display='none';
	x.elements.namedItem('butprint').style.display='none';
	
	
    
	var nform = $('#divattachment').clone(true);
	nform.appendTo( iddcrform );
	document.getElementById('divattachment').style.display = "block";
	document.getElementById('keyvalue').value = data['iddcrform'];
	document.getElementById('keyname').value = 'iddcrform';
	getattachments(data['iddcrform']);
	let xorderform = $('#transferorder').clone(true);
	xorderform.appendTo( iddcrform );
	document.getElementById('transferorder').style.display ="block";
	getorders(data['iddcrform']);
	initload();
	getcase(data['iddcrform'],data['municipal'],data['regional'],data['provincial']);
}
function getcase(iddcrform,municipal,regional,provincial){
var tk=qs['tk'];
$.get("darpoController.php",{trans:"getcase","tk":tk,"iddcrform":iddcrform,"municipal":municipal,"regional":regional,"provincial":provincial},function(data){
										var nlast = data['trackform'].length-1;
										
										var bfound = false;
										var scontent ='';
										
										var nlength = data['trackform'].length
										var today = new Date(); 
										var municipal = data['municipal'];
										var regional = data['regional'];
										
										for(i=0; i < nlength; i++){
										
											var row = data['trackform'][i];
											var officename = row['officename'];
											bfound = true;
											if (nlast == i){
												scontent +="<div class='shadow-sm p-3 mb-5 bg-white rounded'>";
												scontent += "<form>";
												scontent += '<input type="hidden" name="idtrackform" value="'+row['idtrackform']+'">';
												scontent += '<input type="hidden" name="trans" value="savedetails">';
												scontent += '<input type="hidden" name="tk" value="'+qs['tk']+'">';
												var startdate = new Date(row['startdate']);
												var duration = datedifference(startdate, today,5,'DAYS')
												scontent += "<label><small>Status:</small> "+row['status']+"  <small>Date :</small> "+row['startdate']+"  <small>Duration:</small> "+ duration+ "</label><br>";
												scontent += '<div class="form-group">';
												scontent += "<label>Details :</label>";
												var sdetails = row['details'];
												if (!sdetails) {sdetails ='';}
												scontent += '<textarea class="form-control" rows="3" name="details">'+sdetails+'</textarea>';
												//scontent += '<input type="text" class="form-control" name="details" value ="'+sdetails+'">';
												scontent += "</div>";
												
												iddcrform = row['iddcrform'];
												scontent += '<div class="col-md-1"><button type="button" onclick="savedetails(this.form)" class="btn btn-primary">Save</a></div>';
												
												var approvalkey = "'"+row['idtrackform']+"','"+row['iddcrform']+"','"+regional+"','"+row['details']+"','"+officename+"',this.form";
												var provincialkey =  "'"+row['idtrackform']+"','"+row['iddcrform']+"','"+regional+"','"+row['details']+"','"+officename+"',this.form";
												
												scontent += '<div class="col-md-11"><span class="pull-right"><button type="button" onclick="legal('+provincialkey+')" data-toggle="tooltip" title="LEGAL" class="btn btn-link"><span class="glyphicon glyphicon-repeat"></span></button> ';
												scontent += '<button type="button" onclick="approval('+approvalkey+')" data-toggle="tooltip" title="forApproval" class="btn btn-link"><span class="glyphicon glyphicon-thumbs-up"></span></button> ';
												scontent += '<button type="button" onclick="disapproval('+approvalkey+')" data-toggle="tooltip" title="forDisApproval" class="btn btn-link"><span class="glyphicon glyphicon-thumbs-down"></span></button>';
												scontent += "</span></div></form></div>";
											} else {
												scontent += '<div class="col-xs-12 well">';
												var startdate = new Date(row['startdate']);
												var enddate = new Date(row['enddate']);
												var duration = datedifference(startdate, enddate);
												let ncounter = i +1;
												scontent +="<label><small>"+ncounter+". Office: </small><span class='label label-info'>"+row['officename']+"</span></label><br>";
												scontent += "<label><small>Status:</small> "+row['status']+"  <small>Period from: </small>"+row['startdate']+" to "+ row['enddate']+ "  <small> Elapsed Time:</small> "+ duration+ "</label><br>";
												if (row['firstseen']) {scontent += "<label><small>First Seen by:</small> <span class='label label-default'> "+row['firstseen']+" </span> - ";}
												scontent += "<label><small>Processed by: </small></label> <span class='label label-default'> "+row['fullname']+" </span><br>";
												scontent += "<label>Details: </label>";
												scontent += "<p>"+row['details']+"</p>";
												scontent += '</div>';
											}
											
										}
										if (bfound){
												document.getElementById('track'+iddcrform).innerHTML = scontent;
												initload();
											}
										},'json');
}

function showmap(thisform){
$("#myMap").modal("show");
	var lat = thisform.elements.namedItem('latitude').value;
	var lon = thisform.elements.namedItem('longtitude').value;
	
	var propertylocation = thisform.elements.namedItem('propertylocation').value;
	if (lat == 0 && lon == 0){
		lat = 7.07221;
		
		//7.0567022;
		//
		lon = 125.52210;
		//125.6016536;
		//
		propertylocation = "Department Of Agrarian Reform Regional Office XI";
		
	}
	
	
	
	var layer = new ol.layer.Vector({
     source: new ol.source.Vector({
         features: [
             new ol.Feature({
                 geometry: new ol.geom.Point(ol.proj.fromLonLat([lon, lat]))
             })
         ]
			 
		})
		
	 });
	var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([lon, lat]),
          zoom: 17
        })
		
      });
	
	
	 var container = document.getElementById('popup');
	 

	var overlay = new ol.Overlay({
     element: container,
     autoPan: true,
     autoPanAnimation: {
         duration: 250
     }
 });
 
	map.addOverlay(overlay);
	container.innerHTML = '<img src="images/marker.png"><b>'+propertylocation+'</b>';
	overlay.setPosition(ol.proj.fromLonLat([lon, lat]));

}


function cancelthis(thisform){
	$('#ds').DataTable().ajax.reload(null,false);
	
}
function savedetails(thisform){
$("#mySave").modal("show");
var data = $(thisform).serialize();
$.get("darpoController.php",data,function(data){
											$.toaster({ priority : 'success', title : 'LEGAL', message : 'Record Updated'});
											$("#mySave").modal("hide");
									        //$('#ds').DataTable().ajax.reload(null,false);
										},'json');
}
function approval(idtrackform,iddcrform,regional,details,officename,thisform){
bootbox.confirm({
    message: 'Recommend for Approval?',
    buttons: {
        confirm: {
            label: 'Yes',
            className: 'btn-danger'
        },
        cancel: {
            label: 'No',
            className: 'btn-default'
        }
    },
    callback: function (result) {
        if (result){
			if (thisform){
				
				details = thisform.elements.namedItem('details').value;
				
			}
			$("#myRoute").modal("show");
			var tk=qs['tk'];
			{$.get("legalheadController.php",{trans:"forApproval","iddcrform":iddcrform,"idtrackform":idtrackform,"regional":regional,"details":details,"officename":officename,"tk":tk},function(d){
										var officecode = d['officecode'];
											var role = d['role'];
											var iddcrform = d['iddcrform'];
											var officename =d['officename'];
											$.get("sendController.php",{"officecode":officecode,"role":role,"iddcrform":iddcrform,"officename":officename});
											$.toaster({ priority : 'success', title : 'LEGAL Head', message : 'Record recommended for Approval'});
									        $('#ds').DataTable().ajax.reload(null,false);
											$("#myRoute").modal("hide");
										},'json');
			}

		}
    }
});
}
function disapproval(idtrackform,iddcrform,regional,details,officename,thisform){
bootbox.confirm({
    message: 'Recommend for DisApproval?',
    buttons: {
        confirm: {
            label: 'Yes',
            className: 'btn-danger'
        },
        cancel: {
            label: 'No',
            className: 'btn-default'
        }
    },
    callback: function (result) {
        if (result){
			if (thisform){
				
				details = thisform.elements.namedItem('details').value;
				
			}
			$("#myRoute").modal("show");
			var tk=qs['tk'];
			{$.get("legalheadController.php",{trans:"forDisApproval","iddcrform":iddcrform,"idtrackform":idtrackform,"regional":regional,"details":details,"officename":officename,"tk":tk},function(d){
										var officecode = d['officecode'];
											var role = d['role'];
											var iddcrform = d['iddcrform'];
											var officename = d['officename'];
											$.get("sendController.php",{"officecode":officecode,"role":role,"iddcrform":iddcrform,"officename":officename});
											$.toaster({ priority : 'success', title : 'LEGAL Head', message : 'Record recommended for DisApproval'});
									        $('#ds').DataTable().ajax.reload(null,false);
											$("#myRoute").modal("hide");
										},'json');
			}

		}
    }
});
}
function legal(idtrackform,iddcrform,regional,details,officename,thisform){
bootbox.confirm({
    message: 'Return to Legal?',
    buttons: {
        confirm: {
            label: 'Yes',
            className: 'btn-danger'
        },
        cancel: {
            label: 'No',
            className: 'btn-default'
        }
    },
    callback: function (result) {
        if (result){
			$("#myRoute").modal("show");
			if (thisform){
			
				details = thisform.elements.namedItem('details').value;
				
			}
			var tk=qs['tk'];
			{$.get("legalheadController.php",{trans:"forlegal","iddcrform":iddcrform,"idtrackform":idtrackform,"regional":regional,"details":details,"officename":officename,"tk":tk},function(d){
										var officecode = d['officecode'];
											var role = d['role'];
											var iddcrform = d['iddcrform'];
											var officename = d['officename'];
											$.get("sendController.php",{"officecode":officecode,"role":role,"iddcrform":iddcrform,"officename":officename});
											$.toaster({ priority : 'success', title : 'LEGAL Head', message : 'Record returned to Legal'});
									        $('#ds').DataTable().ajax.reload(null,false);
											$("#myRoute").modal("hide");
										},'json');
			}

		}
    }
});
}


</script>
<script src="attachment.js"></script>